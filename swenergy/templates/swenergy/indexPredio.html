{% extends "swenergy/base.html" %}
{% load static %}
<!DOCTYPE html>
<html>
<head>
  {% block head %}
    <meta charset="UTF-8">
    <title>SW - Energy</title>
    <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
    <!--https://getbootstrap.com/docs/4.0/components/forms/-->
  {% endblock %}
  {% block scripts %} 

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load("current", {packages:['corechart']});
        google.charts.setOnLoadCallback(drawChart);
        function drawChart() {
          {% for sensor in predio.sensor_set.all %}
          var data = google.visualization.arrayToDataTable([
            ["Data", "KWh", { role: "style" } ],
            {% for consumo in sensor.consumo_set.all %}
            ['{{consumo.data}}', {{ consumo.total }}, "#ffd700"],
            {% endfor %}
          ]);
    
          var view = new google.visualization.DataView(data);
          view.setColumns([0, 1,
                           { calc: "stringify",
                             sourceColumn: 1,
                             type: "string",
                             role: "annotation" },
                           2]);
    
          var options = {
            title: "Gráfico consumo diário - {{sensor}}",
            width: 600,
            height: 400,
            bar: {groupWidth: "95%"},
            legend: { position: "none" },
          };
          var chart = new google.visualization.ColumnChart(document.getElementById("{{sensor}}"));
          chart.draw(view, options);
          {% endfor %}
      }
    </script>


    {% endblock %}
</head>
{% block conteudo %}
<body>
    <script type="text/javascript" src="https://jscharting.com/JSC15/JSCharting.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

    <div style="display: flex; margin: 30px 30px;">
      <div class="card">
        <img class="card-img-top" src={% static "swenergy/img/nit.png" %} alt="Card image cap" height="350px" width="100px">
        <div class="card-body">
          <h5 class="card-title">Card title</h5>
          <p class="card-text">This is a longer card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
          <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>
        </div>
      </div>
  
      <div class="card border-dark mb-3" style="max-width: 30rem; margin: 5px 70px; height: auto;">
        <div class="card-header">Indicadores:</div>
        <div class="card-body text-dark">
          <ul class="list-group">
            {% for sensor in predio.sensor_set.all %}
              <li class="list-group-item">
                <a href="{% url 'swenergy:detalhes' sensor.id %}">{{sensor.titulo}} - ID: {{sensor.id}}</a>
                <a class="badge badge-primary" href=" {% url 'swenergy:niveis' sensor.id %}">  Níveis de energia</a>
              </li>
            {% endfor %}
          </ul>
        </div>
      </div>
      <div class="card border-dark mb-3" style="max-width: 30rem; margin: 5px 5px; height: auto;">
        <div class="card-header">Sensores:</div>
        <div class="card-body text-dark">
          <ul class="list-group">
            {% for sensor in predio.sensor_set.all %}
              <li class="list-group-item">
                <a href="{% url 'swenergy:detalhes' sensor.id %}">{{sensor.titulo}} - ID: {{sensor.id}}</a>
                <a class="badge badge-primary" href=" {% url 'swenergy:niveis' sensor.id %}">  Níveis de energia</a>
              </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>


    <div class="card border-warning mb-3" style="margin-top: 50px;">
      <div class="card-header">Consumo diário por sensor:</div>
      <div class="card-body text-warning">
        <fieldset>
          {% for sensor in predio.sensor_set.all %}
          <div id="{{sensor}}" style="width: 900px; height: 300px;"></div>
          {% endfor %}
          </fieldset>
      </div>
      </div>
    

    

    

    <br><br>
    <br><br>
    <section class="options">
      <a href="/api/data/">Data</a>
       | 
      <a href="/niveis/1/">Níveis de energia</a>
       | 
      <a href="/data/">Relatório</a>
    </section>

    <section id="conteudo">
    </section>

    <br><br>
    <br><br>
    <br><br>
    <script>
      document.querySelectorAll('.options a').forEach(link => {
      link.onclick = function (e) {
          e.preventDefault()

          const conteudo = document.getElementById('conteudo')
          fetch(link.href)
          .then(resp => resp.text())
          .then(html => (conteudo.innerHTML = html))
      }
      })
    </script>
    <script>
      function redireciona(){
      var search = document.getElementById("search").value;
      location.href="{% url 'swenergy:index' %}" + search;
      }
    </script>
    <fieldset>
      Dados gerais:
      <secntion>
          Data:
          <p>{{data}}</p>
          JSON:
          <p>{{json}}</p>
          Sessão:
          <p>{{session}}</p>
          Args:
          <p>{{args}}</p>
          Kwargs:
          <p>{{kwargs}}</p>

          <br>

          Atributos:
          <ul>
              <li>pt: {{pt}}</li>
          </ul>
      
      </section>
    </fieldset>
    
</body>    
{% endblock %}
</html>