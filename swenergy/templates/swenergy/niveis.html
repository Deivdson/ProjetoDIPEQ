{% extends "swenergy/base.html" %}
{% load static %}
<!DOCTYPE html>
<html>
    <head>
        {% block head %}
        <h1>NÃ­veis de energia</h1>
        <!--<meta http-equiv="refresh" content="5; {% url 'swenergy:niveis' sensor.id %}">-->
        {% endblock %}

        {% block scripts %}
        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
        <script type="text/javascript">
            var request = new XMLHttpRequest();

            request.open('GET', `/api/data/sensor/{{sensor.id}}`);

            request.responseType = 'json';
            var pt = 0;

            request.send();
            request.onload = function(){
            var data = JSON.stringify(request.response);
            var dataJSON = request.response;
            console.log(dataJSON); 
            dataJSON.map((sensor1)=>{
                pt = sensor1.pt;
            });
            }

            var request = new XMLHttpRequest();

            request.open('GET', `/api/data/fase/{{sensor.id}}`);

            request.responseType = 'json';
            var pa=0;
            var pb=0;
            var pc=0;

            request.send();
            request.onload = function(){
            var data = JSON.stringify(request.response);
            var dataJSON = request.response;
            console.log(dataJSON); 
            dataJSON.map((fase)=>{
                if(fase.tipo=="A"){
                    pa = fase.p
                }
                else if(fase.tipo=="B"){
                    pb = fase.p
                }
                else if(fase.tipo=="C"){
                    pc = fase.p
                }
                
            });
            }
                        
                   
            setInterval(function(){
                var request = new XMLHttpRequest();

                request.open('GET', `/api/data/sensor/{{sensor.id}}`);

                request.responseType = 'json';

                request.send();
                request.onload = function(){
                var data = JSON.stringify(request.response);
                var dataJSON = request.response;
                console.log(dataJSON); 
                dataJSON.map((sensor1)=>{
                    pt = sensor1.pt;
                    console.log("PT: "+sensor1.pt)
                });
                }
                
            }, 3000);

            setInterval(function(){
                var request = new XMLHttpRequest();

                request.open('GET', `/api/data/fase/{{sensor.id}}`);

                request.responseType = 'json';

                request.send();
                request.onload = function(){
                var data = JSON.stringify(request.response);
                var dataJSON = request.response;
                console.log(dataJSON); 
                dataJSON.map((fase)=>{
                    p = fase.p;
                    console.log("P: "+fase.p)
                });
                }
                
            }, 3000);

          google.charts.load('current', {'packages':['gauge']});
          google.charts.setOnLoadCallback(drawChart);

           function drawChart() {
          
             var data = google.visualization.arrayToDataTable([
               ['Label', 'Value'],
               ['pt',       pt ],
               ['qt',       0 ],
               ['st',       0 ],
               ['itrms',    0 ],
               ['pft',      0 ],
               ['freq',     0 ],
               ['ept',      0 ],
               ['eqt',      0 ],
               ['yuaub',    0 ],
               ['yuauc',    0 ],
               ['yubuc',    0 ],
               ['tpsd',     0] 
             ]);
     
             var options = {
               width: 800, height: 240,
               redFrom: 90, redTo: 100,
               yellowFrom:75, yellowTo: 90,
               minorTicks: 5
             };
     
             var chart = new google.visualization.Gauge(document.getElementById('chart_div'));
     
             chart.draw(data, options);

             setInterval(function() {
               data.setValue(0, 1, pt);
               chart.draw(data, options);
             }, 3000);
             setInterval(function() {
               data.setValue(1, 1, 40 + Math.round(60 * Math.random()));
               chart.draw(data, options);
             }, 3000);
             setInterval(function() {
               data.setValue(2, 1, 60 + Math.round(20 * Math.random()));
               chart.draw(data, options);
             }, 3000);
             setInterval(function() {
               data.setValue(3, 1, 60 + Math.round(20 * Math.random()));
               chart.draw(data, options);
             }, 26000);
             setInterval(function() {
               data.setValue(4, 1, 60 + Math.round(20 * Math.random()));
               chart.draw(data, options);
             }, 26000);
             setInterval(function() {
               data.setValue(5, 1, 60 + Math.round(20 * Math.random()));
               chart.draw(data, options);
             }, 26000);
             setInterval(function() {
               data.setValue(6, 1, 60 + Math.round(20 * Math.random()));
               chart.draw(data, options);
             }, 26000);
             setInterval(function() {
               data.setValue(7, 1, 60 + Math.round(20 * Math.random()));
               chart.draw(data, options);
             }, 26000);
             setInterval(function() {
               data.setValue(8, 1, 60 + Math.round(20 * Math.random()));
               chart.draw(data, options);
             }, 26000);
             setInterval(function() {
               data.setValue(9, 1, 60 + Math.round(20 * Math.random()));
               chart.draw(data, options);
             }, 26000);
             setInterval(function() {
               data.setValue(10, 1, 60 + Math.round(20 * Math.random()));
               chart.draw(data, options);
             }, 26000);
             setInterval(function() {
               data.setValue(11, 1, 60 + Math.round(20 * Math.random()));
               chart.draw(data, options);
             }, 26000);
            
            
             var dataF = google.visualization.arrayToDataTable([
              ['Label', 'Value'],
              ['p',     pa ],
              ['q',     0 ],
              ['s',     0 ],
              ['urms',  0 ],
              ['itrms', 0 ],
              ['pf',    0 ],
              ['pg',    0 ],
              ['eq',    0 ]                       
            ]);

            var optionsF = {
              width: 800, height: 240,
              redFrom: 90, redTo: 100,
              yellowFrom:75, yellowTo: 90,
              minorTicks: 5
            };

            var chartF = new google.visualization.Gauge(document.getElementById('chart_div_FA'));

            chartF.draw(dataF, optionsF);

            

            setInterval(function() {
               data.setValue(0, 1, 0);
               chart.draw(data, options);
             }, 13000);
             setInterval(function() {
               data.setValue(13, 1, 40 + Math.round(60 * Math.random()));
               chart.draw(data, options);
             }, 5000);
             setInterval(function() {
               data.setValue(14, 1, 60 + Math.round(20 * Math.random()));
               chart.draw(data, options);
             }, 26000);
             setInterval(function() {
               data.setValue(15, 1, 60 + Math.round(20 * Math.random()));
               chart.draw(data, options);
             }, 26000);
             setInterval(function() {
               data.setValue(16, 1, 60 + Math.round(20 * Math.random()));
               chart.draw(data, options);
             }, 26000);
             setInterval(function() {
               data.setValue(17, 1, 60 + Math.round(20 * Math.random()));
               chart.draw(data, options);
             }, 26000);
             setInterval(function() {
               data.setValue(18, 1, 60 + Math.round(20 * Math.random()));
               chart.draw(data, options);
             }, 26000);
             setInterval(function() {
               data.setValue(19, 1, 60 + Math.round(20 * Math.random()));
               chart.draw(data, options);
             }, 26000);
             setInterval(function() {
               data.setValue(20, 1, 60 + Math.round(20 * Math.random()));
               chart.draw(data, options);
             }, 26000);


             var dataF = google.visualization.arrayToDataTable([
              ['Label', 'Value'],
              ['p',     pb],
              ['q',     0],
              ['s',     0],
              ['urms',  0],
              ['itrms', 0],
              ['pf',    0],
              ['pg',    0],
              ['eq',    0]                        
            ]);

            var optionsF = {
              width: 800, height: 240,
              redFrom: 90, redTo: 100,
              yellowFrom:75, yellowTo: 90,
              minorTicks: 5
            };

            var chartF = new google.visualization.Gauge(document.getElementById('chart_div_FB'));

            chartF.draw(dataF, optionsF);

            var dataF = google.visualization.arrayToDataTable([
              ['Label', 'Value'],
              ['p',     pc],
              ['q',     0],
              ['s',     0],
              ['urms',  0],
              ['itrms', 0],
              ['pf',    0],
              ['pg',    0],
              ['eq',    0]                        
            ]);

          var optionsF = {
            width: 800, height: 240,
            redFrom: 90, redTo: 100,
            yellowFrom:75, yellowTo: 90,
            minorTicks: 5
          };

          var chartF = new google.visualization.Gauge(document.getElementById('chart_div_FC'));

          chartF.draw(dataF, optionsF);
        }
        
         </script>        
        
        {% endblock %}
    </head>
    <body>          
        {% block conteudo %}   
        <h2>Geral:</h2> 

        <div id="tables" style="height: 50%; width:50% ;">

        </div>

        <div id="chart_div" style="width: 800px; height: 240px;"></div>

        <h2>Fase A</h2>
        <div id="chart_div_FA" style="width: 800px; height: 240px;"></div>
        <h2>Fase B</h2>
        <div id="chart_div_FB" style="width: 800px; height: 240px;"></div>
        <h2>Fase C</h2>
        <div id="chart_div_FC" style="width: 800px; height: 240px;"></div>
        {% endblock %}
    </body>
</html>








