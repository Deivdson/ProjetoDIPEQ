{% extends "swenergy/base.html" %}
{% load static %}
<!DOCTYPE html>
<html>
<head>
    {% block head%}
    <meta charset="UTF-8">
    <title>Contas de Energia</title>
    {%endblock%}

    {% block scripts %} 

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load("current", {packages:['corechart']});
        google.charts.setOnLoadCallback(drawChart);
        function drawChart() {          
          {% for sensor in predio.sensor_set.all %}
          var data = google.visualization.arrayToDataTable([
            ["Data", "KWh", { role: "style" } ],
                                                                
            {% for consumo in sensor.consumo_set.all %}
              {% if consumo.tipo == 'mensal' %}
                ['{{consumo.data}}', {{ consumo.total }}, "#ffd700"],
              {% endif %}
            {% endfor %}
            
          ]);
    
          var view = new google.visualization.DataView(data);
          view.setColumns([0, 1,
                           { calc: "stringify",
                             sourceColumn: 1,
                             type: "string",
                             role: "annotation" },
                           2]);
    
          var options = {
            title: "Gráfico consumo mensal - {{sensor}}",
            width: 600,
            height: 400,
            bar: {groupWidth: "95%"},
            legend: { position: "none" },
          };
          var chart = new google.visualization.ColumnChart(document.getElementById("{{sensor}}_mensais"));
          chart.draw(view, options);
          {% endfor %}
      }
    </script>


    {% endblock %}
</head>

{% block conteudo %}
<body style="background-color: rgb(197, 197, 197);">
    <fieldset style="padding: 10px 30px; width: 100%;height: 100%;">

          <div id="carouselExampleControls" class="carousel slide " data-ride="carousel" >
            <div class="carousel-inner">
              <div class="carousel-item active" style="margin: 10%;">
                    <div class="card bg-light mb-3" style="max-width: 80%; min-height: 100%;">
                        <div class="card-header">Listagem de Custos</div>
                        <div class="card-body" style="overflow: scroll;">
                            
                            <div style="min-width: 900px; min-height: 400px;">
                                <table class="table table-sm">
                                    <thead>
                                      <tr>
                                        <th scope="col">Mês</th>
                                        <th scope="col">Kwh</th>
                                        <th scope="col">Custo</th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                        {% for sensor in predio.sensor_set.all %}
                                          {% for consumo in sensor.consumo_set.all %}
                                            {% if consumo.tipo == "mensal" %}                
                                            <tr>
                                                <td>{{consumo.data}}</td>
                                                <td>{{consumo.total}}</td>
                                                <td>{{consumo.custo.FP}}</td>
                                              </tr>
                                            {% endif %}
                                          {%endfor%}     
                                        {%endfor%}                                 
                                    </tbody>
                                  </table>
                            </div>
                            
                        </div>
                    </div>
              </div>
              <div class="carousel-item" style="margin: 10% ">                     
                    <div class="card bg-light mb-3" style="max-width: 80%;">
                        <div class="card-header">Gráfico de custos</div>
                        <div class="card-body">
                          {% for sensor in predio.sensor_set.all %}                           
                                <div id="{{sensor}}_mensais" style="min-width: 900px; min-height: 300px;"></div>              
                          {% endfor %}
                        </div>
                      </div>              
              </div>
              </div>
              
            <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="sr-only">Next</span>
            </a>
          </div>
    
    </section>
    </fieldset>    
    <footer style="margin-left: 50%;"> &#xa9; SWEnergy</footer>
</body>
    {%endblock%}

</html>